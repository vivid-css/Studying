# 用OpenMP实现并行编程

## 1.常用指令
---
- **# pragma omp for**
  - for表示接下来的程序将并行处理
 `前提是此区域已经用指令parallel初始化，否则还是以串行方式执行`
  - for要求线程组共享计数器
  - 利用parallel指令将N次循环置于并行区域
  - 利用for指令将N次循环进行任务分配
  - 每个线程负责各自的部分，要保证循环之间数据的独立性

### `注意`
```bash
1.for之后紧跟循环体
2.while do...while不能使用for指令，要转换成for循环
3.for循环中i要求是整数，且每次增加数不变
4.循环要求单入口，单出口（break  go...to语句特殊）
5.循环变量默认共有，循环计数器默认共有，i默认私有
6.要求不存在数据相关和数据竞争
```
- 嵌套循环
  - 将指令`parallel for`置于循环之前，可以对最近的循环进行并行化处理
- 数据竞争
  - 在parallel区域由两个以上的线程对相同的通向变量同时进行写操作

- collapse
  - 让代码在不嵌套并行的情况下对多重循环进行并行
  - 先当于将多个循环合并后展开成一个更大的循环
```bash
eg. #pragma omp parallel for collapse(2) shared(a,b,c,M,N,P) private(j)
    for (int i = 0;i<M;i++)
    for (int k = 0;k<P;k++)
    for (int j = 0;j<N;j++)
    c[i,k] = c[i,k]+a[i,j]*b[j+k];
```
并行一二循环，第三个循环还是串行，不会出现数据竞争
若并行一二三循环，则第三个循环参与并行，会出现数据竞争

- 分段并行